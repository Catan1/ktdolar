<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dólar Argentina - Histórico Oficial vs Blue</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            padding: 40px;
        }

        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 2.5em;
        }

        .subtitle {
            text-align: center;
            color: #7f8c8d;
            margin-bottom: 30px;
            font-size: 1.1em;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            transition: transform 0.3s;
        }

        .stat-card.blue-card {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-label {
            font-size: 0.85em;
            opacity: 0.9;
            margin-bottom: 8px;
        }

        .stat-value {
            font-size: 1.8em;
            font-weight: bold;
        }

        .controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            background: #667eea;
            color: white;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s;
        }

        .btn:hover {
            background: #764ba2;
            transform: scale(1.05);
        }

        .btn.active {
            background: #764ba2;
            box-shadow: 0 4px 15px rgba(118, 75, 162, 0.4);
        }

        .chart-container {
            position: relative;
            height: 500px;
            margin-bottom: 30px;
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #7f8c8d;
            font-size: 1.2em;
        }

        .footer {
            text-align: center;
            color: #7f8c8d;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #ecf0f1;
        }

        .info-box {
            background: #e8f4f8;
            border-left: 4px solid #3498db;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 8px;
        }

        .info-box p {
            margin: 5px 0;
            color: #2c3e50;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .container {
            animation: fadeIn 0.6s ease-out;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>💵 Dólar Oficial vs Blue</h1>
        <p class="subtitle">Comparación histórica completa - Datos oficiales BCRA y DolarAPI</p>

        <div class="info-box" id="infoBox">
            <p><strong>📊 Datos cargados:</strong> <span id="totalDatos">Cargando...</span></p>
            <p><strong>📅 Período:</strong> <span id="periodo">Calculando...</span></p>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-label">Dólar Oficial</div>
                <div class="stat-value" id="oficialActual">$--</div>
            </div>
            <div class="stat-card blue-card">
                <div class="stat-label">Dólar Blue</div>
                <div class="stat-value" id="blueActual">$--</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Brecha</div>
                <div class="stat-value" id="brecha">--%</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Variación Oficial</div>
                <div class="stat-value" id="varOficial">--%</div>
            </div>
            <div class="stat-card blue-card">
                <div class="stat-label">Variación Blue</div>
                <div class="stat-value" id="varBlue">--%</div>
            </div>
        </div>

        <div class="controls">
            <button class="btn" onclick="cambiarPeriodo(30)">1 Mes</button>
            <button class="btn" onclick="cambiarPeriodo(90)">3 Meses</button>
            <button class="btn" onclick="cambiarPeriodo(180)">6 Meses</button>
            <button class="btn active" onclick="cambiarPeriodo(365)">1 Año</button>
            <button class="btn" onclick="cambiarPeriodo(730)">2 Años</button>
            <button class="btn" onclick="cambiarPeriodo(0)">Todo</button>
        </div>

        <div class="chart-container">
            <canvas id="chartDolar"></canvas>
        </div>

        <div class="footer">
            <p><strong>Fuentes:</strong> Banco Central de la República Argentina (BCRA) - DolarAPI.com</p>
            <p>Actualización: <span id="fecha"></span></p>
        </div>
    </div>

    <script>
        let chartInstance = null;
        let datosOficial = [];
        let datosBlue = [];
        let periodoActual = 365;

        async function obtenerDatosOficial() {
            try {
                const url = 'https://apis.datos.gob.ar/series/api/series';
                const params = new URLSearchParams({
                    ids: '168.1_T_CAMBIOR_D_0_0_26',
                    limit: '10000',
                    format: 'json'
                });

                const response = await fetch(`${url}?${params}`);
                const data = await response.json();

                if (data.data && data.data.length > 0) {
                    datosOficial = data.data.map(item => ({
                        fecha: new Date(item[0]),
                        valor: parseFloat(item[1])
                    })).filter(item => !isNaN(item.valor)).sort((a, b) => a.fecha - b.fecha);
                    
                    console.log('Dólar Oficial cargado:', datosOficial.length, 'registros');
                }
            } catch (error) {
                console.error('Error al obtener dólar oficial:', error);
            }
        }

        async function obtenerDatosBlue() {
            try {
                // Usar DolarAPI para obtener datos históricos del blue
                const response = await fetch('https://api.bluelytics.com.ar/v2/evolution.json');
                const data = await response.json();

                if (data && Array.isArray(data)) {
                    datosBlue = data.map(item => ({
                        fecha: new Date(item.date),
                        valor: (item.blue.value_sell + item.blue.value_buy) / 2
                    })).filter(item => !isNaN(item.valor)).sort((a, b) => a.fecha - b.fecha);
                    
                    console.log('Dólar Blue cargado:', datosBlue.length, 'registros');
                }
            } catch (error) {
                console.error('Error al obtener dólar blue:', error);
                // Intentar fuente alternativa
                try {
                    const response2 = await fetch('https://dolarapi.com/v1/dolares/blue');
                    const data2 = await response2.json();
                    if (data2 && data2.venta) {
                        datosBlue = [{
                            fecha: new Date(),
                            valor: (data2.venta + data2.compra) / 2
                        }];
                    }
                } catch (error2) {
                    console.error('Error con fuente alternativa:', error2);
                }
            }
        }

        async function cargarDatos() {
            document.getElementById('infoBox').innerHTML = '<div class="spinner"></div><p style="text-align:center">Cargando datos históricos...</p>';
            
            await Promise.all([obtenerDatosOficial(), obtenerDatosBlue()]);
            
            if (datosOficial.length > 0 || datosBlue.length > 0) {
                actualizarInfo();
                actualizarEstadisticas();
                crearGrafico();
            } else {
                document.getElementById('infoBox').innerHTML = '<p style="color: red">❌ Error al cargar los datos. Por favor, intenta más tarde.</p>';
            }
        }

        function actualizarInfo() {
            const totalOficial = datosOficial.length;
            const totalBlue = datosBlue.length;
            
            const fechaMin = new Date(Math.min(
                datosOficial.length > 0 ? datosOficial[0].fecha : Infinity,
                datosBlue.length > 0 ? datosBlue[0].fecha : Infinity
            ));
            
            const fechaMax = new Date(Math.max(
                datosOficial.length > 0 ? datosOficial[datosOficial.length - 1].fecha : 0,
                datosBlue.length > 0 ? datosBlue[datosBlue.length - 1].fecha : 0
            ));

            document.getElementById('totalDatos').textContent = `${totalOficial} registros oficial, ${totalBlue} registros blue`;
            document.getElementById('periodo').textContent = `${fechaMin.toLocaleDateString('es-AR')} - ${fechaMax.toLocaleDateString('es-AR')}`;
        }

        function filtrarDatos(datos, dias) {
            if (dias === 0) return datos;
            const fechaLimite = new Date();
            fechaLimite.setDate(fechaLimite.getDate() - dias);
            return datos.filter(item => item.fecha >= fechaLimite);
        }

        function actualizarEstadisticas() {
            const oficialFiltrado = filtrarDatos(datosOficial, periodoActual);
            const blueFiltrado = filtrarDatos(datosBlue, periodoActual);
            
            if (oficialFiltrado.length > 0) {
                const valorActualOficial = oficialFiltrado[oficialFiltrado.length - 1].valor;
                const valorInicialOficial = oficialFiltrado[0].valor;
                const varOficial = ((valorActualOficial / valorInicialOficial - 1) * 100).toFixed(2);
                
                document.getElementById('oficialActual').textContent = `$${valorActualOficial.toFixed(2)}`;
                document.getElementById('varOficial').textContent = `${varOficial}%`;
                document.getElementById('varOficial').style.color = varOficial >= 0 ? '#fff' : '#27ae60';
            }
            
            if (blueFiltrado.length > 0) {
                const valorActualBlue = blueFiltrado[blueFiltrado.length - 1].valor;
                const valorInicialBlue = blueFiltrado[0].valor;
                const varBlue = ((valorActualBlue / valorInicialBlue - 1) * 100).toFixed(2);
                
                document.getElementById('blueActual').textContent = `$${valorActualBlue.toFixed(2)}`;
                document.getElementById('varBlue').textContent = `${varBlue}%`;
                document.getElementById('varBlue').style.color = varBlue >= 0 ? '#fff' : '#27ae60';
                
                if (oficialFiltrado.length > 0) {
                    const valorActualOficial = oficialFiltrado[oficialFiltrado.length - 1].valor;
                    const brecha = ((valorActualBlue / valorActualOficial - 1) * 100).toFixed(2);
                    document.getElementById('brecha').textContent = `${brecha}%`;
                }
            }
            
            document.getElementById('fecha').textContent = new Date().toLocaleString('es-AR');
        }

        function crearGrafico() {
            const oficialFiltrado = filtrarDatos(datosOficial, periodoActual);
            const blueFiltrado = filtrarDatos(datosBlue, periodoActual);
            
            const ctx = document.getElementById('chartDolar').getContext('2d');

            if (chartInstance) {
                chartInstance.destroy();
            }

            // Combinar fechas únicas
            const todasFechas = [...new Set([
                ...oficialFiltrado.map(d => d.fecha.getTime()),
                ...blueFiltrado.map(d => d.fecha.getTime())
            ])].sort((a, b) => a - b).map(t => new Date(t));

            const labelsOficial = oficialFiltrado.map(d => d.fecha.toLocaleDateString('es-AR'));
            const valoresOficial = oficialFiltrado.map(d => d.valor);
            
            const labelsBlue = blueFiltrado.map(d => d.fecha.toLocaleDateString('es-AR'));
            const valoresBlue = blueFiltrado.map(d => d.valor);

            const datasets = [];
            
            if (oficialFiltrado.length > 0) {
                datasets.push({
                    label: 'Dólar Oficial',
                    data: valoresOficial,
                    borderColor: '#667eea',
                    backgroundColor: 'rgba(102, 126, 234, 0.1)',
                    borderWidth: 3,
                    fill: false,
                    tension: 0.4,
                    pointRadius: 1,
                    pointHoverRadius: 5
                });
            }
            
            if (blueFiltrado.length > 0) {
                datasets.push({
                    label: 'Dólar Blue',
                    data: valoresBlue,
                    borderColor: '#3498db',
                    backgroundColor: 'rgba(52, 152, 219, 0.1)',
                    borderWidth: 3,
                    fill: false,
                    tension: 0.4,
                    pointRadius: 1,
                    pointHoverRadius: 5
                });
            }

            // Usar las etiquetas del dataset con más datos
            const labels = oficialFiltrado.length >= blueFiltrado.length ? labelsOficial : labelsBlue;

            chartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'index',
                        intersect: false
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                            labels: {
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.dataset.label}: $${context.parsed.y.toFixed(2)} ARS`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            display: true,
                            ticks: {
                                maxTicksLimit: 12,
                                autoSkip: true
                            }
                        },
                        y: {
                            display: true,
                            beginAtZero: false,
                            ticks: {
                                callback: function(value) {
                                    return '$' + value.toFixed(0);
                                }
                            }
                        }
                    }
                }
            });
        }

        function cambiarPeriodo(dias) {
            periodoActual = dias;
            
            document.querySelectorAll('.btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            actualizarEstadisticas();
            crearGrafico();
        }

        // Cargar datos al iniciar
        cargarDatos();

        // Actualizar cada 10 minutos
        setInterval(cargarDatos, 600000);
    </script>
</body>
</html>